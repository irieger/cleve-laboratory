function arrowhead(~,~)
%% Lake Arrowhead Coauthor Graph

%% The Data

   if nargin == 0
       A = arrowhead_adjacency;
       names = arrowhead_names;
       h = handles(names);
   else
       u = get(gcf,'userdata');
       [A,names,h] = deal(u{:});
   end
   
%% Author
    s = get(h.author,'string');
    v = get(h.author,'value');
    if v > 2
        author = s{v};
        G = graph(A,names);
        id = findnode(G,author);
        p = [id 1:id-1 id+1:length(names)];
        A = A(p,p);
        names = names(p);
    else
        author = [];
        id = 0;
    end
    
%% Permutation
    s = get(h.perm,'string');
    v = get(h.perm,'value');
    perm = s{v};
    switch perm
        case 'original'
            A = arrowhead_adjacency;
            names = arrowhead_names;
        case 'alpha'
            [names,p] = sort(names);
            A = A(p,p);
        case 'symrcm'
            p = [1 symrcm(A(2:end,2:end))+1];
            names = names(p);
            A = A(p,p);
        case 'amd'
            p = [1 amd(A(2:end,2:end))+1];
            names = names(p);
            A = A(p,p);       
        case 'colperm'
            p = colperm(A);
            names = names(p);
            A = A(p,p);
    end
    
%% Layout
    s = get(h.layout,'string');
    v = get(h.layout,'val');
    if v == 1
        v = 4;  % 'auto'
    end
    layout = s{v};
    switch layout
        case 'photo'
            imshow(imread('mg4872.jpg'))
            return
        case 'spy'
            spy(A)
            return     
        otherwise
            % continue
    end

%% Initial plot

   G = graph(A,names);
   Gp = plot(G,'layout',layout);
   axis off square
    
%% Move author to the center.

   if ~isempty(author)
       id = findnode(G,author);
       Gp.XData(id) = 0;
       Gp.YData(id) = 0;
       axis square
   end
   
%%
% Place the rest of the names around the outside of the circle.

   if isequal(layout,'circle')
       txt = text(Gp.XData,Gp.YData,names);
       theta = linspace(0,360,numel(txt)+1);
       for k = 1:numel(txt)
           if k ~= id
               txt(k).Rotation = theta(k);
           end
           txt(k).String = [blanks(4) txt(k).String]; 
           txt(k).FontSize = 8;
       end
   else
       Gp = plot(G,'layout',layout, ...
           'nodelabelmode','auto');
       axis off square
   end
   
%%
% Highlight author and coauthors.

   if ~isempty(author)
       friends = neighbors(G,id)';
       color = get(gca,'colororder');
       highlight(Gp,[id friends],'nodecolor',color(2,:),'markersize',4)
       highlight(Gp,id,friends,'edgecolor',color(2,:),'linewidth',2)
 
       % Make author's node the center of the universe.

       set(Gp,'xdata',Gp.XData - Gp.XData(id), ...
             'ydata',Gp.YData - Gp.YData(id), ...
             'zdata',Gp.ZData - Gp.ZData(id))
   end % ~isempty
   
% Finish

   cameratoolbar(gcf)
   set(gcf,'userdata',{A,names,h})
     
% end of main -------------------------------------------------------
     
%% handles

    function h = handles(names)
        clf
        set(gcf,'name','arrowhead', ...
           'toolbar','none', ...
           'menu','none', ...
           'numbertitle','off');
       
        authors = [{'authors ...'},{'  '},sort(names)];
        h.author = uicontrol('style','popupmenu', ...
            'tag','authors', ...
            'units','normalized', ...
            'position',[.075 .02 .25 .05], ...
            'string',authors, ...
            'value',2, ...
            'callback',@arrowhead);
        
        perms = {'perms ...','original','alpha', ...
            'symrcm','amd','colperm'};
        h.perm = uicontrol('style','popupmenu', ...
            'tag','perms', ...
            'units','normalized', ...
            'position',[.375 .02 .25 .05], ...
            'string',perms, ...
            'value',2, ...
            'callback',@arrowhead);
        
        layouts = {'layouts ...','photo','spy', ...
            'circle','force','layered','subspace', ...
            'force3','subspace3'};
        h.layout = uicontrol('style','popupmenu', ...
            'tag','layouts', ...
            'units','normalized', ...
            'position',[.675 .02 .25 .05], ...
            'string',layouts, ...
            'value',4,...
            'callback',@arrowhead);
        
      uicontrol('style','pushbutton', ...
          'units','normalized', ...
          'position',[.90 .92 .08 .06], ...
          'string','info', ...
          'fontweight','bold', ...
          'background','white', ...
          'callback', ...
              'web(''https://blogs.mathworks.com/cleve/2017/03/06'')');   
      uicontrol( ...
          'style','toggle', ...
          'string','exit', ...
          'fontweight','bold', ...
          'visible','on', ...
          'units','normalized', ...
          'position',[.90 .84 .08 .06], ...
          'background','white', ...
          'callback','close(gcf)');

    end

%% arrowhead_adjacency

   function A = arrowhead_adjacency
     k = [ 1  1   1   1   1   3   3   1   1   1   1   2   3   3  38   1   2 ...
     32  42   3  32  42  43  44  44   1  46   1   1  37  13  49   1  32   1 ...
     44  53   1  53  44  45  54   1   1  20  41  44   1  39  52  60  15  58 ...
     61   3  63  41  43   1  15  35  51  61  41  43  59  65  53   3  58  63 ...
     42   1  41  44   1  46  47   1  10  15  32  35  62  66   2  19  39  58 ...
     61  66  69  37  53   1   9  72  42   8  21  32  42  77   1   7  15  46 ...
     47  49   6  42  66   1   3  25  41  43  59  65  67  80  33  52  59  27 ...
     28  46  74  31  51  46   1  22  23  24  25  35  41  52  81   3  21  55 ...
     60  44  58  62   4  17  12  19  23  72  77  89   1  23  86   1  23  86 ...
     91   4  72  90  19  90  48   1  18  25  77  82  86  17  52  66  86  89 ...
     16  32  34  58  66  80  81   1  34  74  77  14  82  77  79  49 102  26 ...
     32  39  44  48  51  52  56  63  69  74  78  81  83  90];

     j = [ 2  3   5  10  11  29  30  32  34  35  36  36  38  40  40  41  42 ...
     42  43  44  44  44  44  45  46  47  47  48  49  49  50  50  51  51  53 ...
     54  54  55  55  56  56  57  58  59  59  59  59  60  60  60  61  62  62 ...
     62  63  64  65  65  66  66  66  66  66  67  67  67  67  68  69  69  69 ...
     70  71  71  71  72  72  72  73  73  73  73  73  73  73  74  74  74  74 ...
     74  74  74  75  75  76  76  76  77  78  78  78  78  78  79  79  79  79 ...
     79  79  80  80  80  81  81  81  81  81  81  81  81  81  82  82  82  83 ...
     83  83  83  84  84  85  86  86  86  86  86  86  86  86  86  87  87  87 ...
     87  88  88  88  89  89  90  90  90  90  90  90  91  91  91  92  92  92 ...
     92  93  93  93  94  94  95  96  96  96  96  96  96  97  97  97  97  97 ...
     98  98  98  98  98  98  98  99  99  99  99 100 100 101 102 103 103 104 ...
     104 104 104 104 104 104 104 104 104 104 104 104 104 104];

     U = sparse(k,j,1,104,104);
     A = logical(U + U');
  end

%% arrowhead_names

  function names = arrowhead_names
    names = {'Golub', 'Wilkinson', 'TChan', 'He', 'Varah', 'Kenney', ...
    'Ashby', 'LeBorne', 'Modersitzki', 'Overton', 'Ernst', 'Borges', ...
    'Kincaid', 'Crevelli', 'Boley', 'Anjos', 'Byers', 'Benzi', 'Kaufman', ...
    'Gu', 'Fierro', 'Nagy', 'Harrod', 'Pan', 'Funderlic', 'Edelman', ...
    'Cullum', 'Strakos', 'Saied', 'Ong', 'Wold', 'VanLoan', ...
    'Chandrasekaran', 'Saunders', 'Bojanczyk', 'Dubrulle', 'Marek', ...
    'Kuo', 'Bai', 'Tong', 'George', 'Moler', 'Gilbert', 'Schreiber', ...
    'Pothen', 'NTrefethen', 'Nachtigal', 'Kahan', 'Varga', 'Young', ...
    'Kagstrom', 'Barlow', 'Widlund', 'Bjorstad', 'OLeary', 'NHigham', ...
    'Boman', 'Bjorck', 'Eisenstat', 'Zha', 'VanHuffel', 'Park', 'Arioli', ...
    'MuntheKaas', 'Ng', 'VanDooren', 'Liu', 'Smith', 'Duff', 'Henrici', ...
    'Tang', 'Reichel', 'Luk', 'Hammarling', 'Szyld', 'Fischer', ...
    'Stewart', 'Bunch', 'Gutknecht', 'Laub', 'Heath', 'Ipsen', ...
    'Greenbaum', 'Ruhe', 'ATrefethen', 'Plemmons', 'Hansen', 'Elden', ...
    'BunseGerstner', 'Gragg', 'Berry', 'Sameh', 'Ammar', 'Warner', ...
    'Davis', 'Meyer', 'Nichols', 'Paige', 'Gill', 'Jessup', 'Mathias', ...
    'Hochbruck', 'Starke', 'Demmel'}; 
  end
  
end % function arrowhead

